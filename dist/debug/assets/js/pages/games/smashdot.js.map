{"version":3,"sources":["app/pages/games/smashdot.js"],"names":["Reporting","reporting","firebase","database","ref","_drawGamePlayed","_drawUsersPlayed","_drawLastPlayed","_drawClassicRankings","_drawSurvivalRankings","_drawMaxScores","_drawModesPlayed","filter","max","count","then","value","jQuery","text","catch","err","console","log","uid","currentUID","mode","pr","greater","min","sum","select","values","total","last","date","Date","setTime","attr","toISOString","timeago","Promise","all","element","data","google","visualization","arrayToDataTable","options","title","width","height","pieHole","legend","position","chart","PieChart","draw","ColumnChart","charts","load","setOnLoadCallback","report","requireAuth","$","document","ready","window","resize"],"mappings":"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","file":"public/assets/js/pages/games/smashdot.js","sourcesContent":["import GameReporting from '@greenhousegames/smash-dot/dist/reporting';\nimport FirebaseClient from 'firebase-client.js';\n\nclass Reporting extends FirebaseClient {\n  constructor() {\n    super();\n    this.reporting = new GameReporting(this.firebase.database().ref('games/smashdot/data'), this.firebase.database().ref('games/smashdot/reporting'));\n  }\n\n  draw() {\n    // metrics\n    this._drawGamePlayed();\n    this._drawUsersPlayed();\n    this._drawLastPlayed();\n\n    // rankings\n    this._drawClassicRankings();\n    this._drawSurvivalRankings();\n\n    // charts\n    this._drawMaxScores();\n    this._drawModesPlayed();\n  }\n\n  _drawClassicRankings() {\n    this.reporting.filter('users').max('classic-score').count().then((value) => {\n      jQuery('#classic_ranking2').text('of ' + value);\n    }).catch(function(err) { console.log(err); });\n\n    this.reporting.filter('users-modes', {\n      uid: this.currentUID(),\n      mode: 'classic'\n    }).max('classic-score').value().then((pr) => {\n      if (pr) {\n        this.reporting.filter('users', {\n          uid: this.currentUID()\n        }).max('classic-score').greater(pr).count().then((value) => {\n          jQuery('#classic_ranking1').text('#' + value);\n        });\n      } else {\n        jQuery('#classic_ranking1').text('N/A');\n      }\n    }).catch(function(err) { console.log(err); });\n  }\n\n  _drawSurvivalRankings() {\n    this.reporting.filter('users').min('survival-duration').count().then((value) => {\n      jQuery('#survival_ranking2').text('of ' + value);\n    }).catch(function(err) { console.log(err); });\n\n    this.reporting.filter('users-modes', {\n      uid: this.currentUID(),\n      mode: 'survival'\n    }).min('survival-duration').value().then((pr) => {\n      if (pr) {\n        this.reporting.filter('users', {\n          uid: this.currentUID()\n        }).min('survival-duration').greater(pr).count().then((value) => {\n          jQuery('#survival_ranking1').text('#' + value);\n        });\n      } else {\n        jQuery('#survival_ranking1').text('N/A');\n      }\n    }).catch(function(err) { console.log(err); });\n  }\n\n  _drawGamePlayed() {\n    this.reporting.filter().sum('played').select(1).then(function(values) {\n      jQuery('#game_played_count').text(values[0] || 0);\n    }).catch(function(err) { console.log(err); });\n  }\n\n  _drawUsersPlayed() {\n    this.reporting.filter('users').sum('played').count().then(function(total) {\n      jQuery('#user_played_count').text(total);\n    }).catch(function(err) { console.log(err); });\n  }\n\n  _drawLastPlayed() {\n    this.reporting.filter().last('endedAt').select(1).then(function(values) {\n      if (!values[0]) {\n        jQuery('#last_played_timestamp').text('never');\n      } else {\n        var date = new Date();\n        date.setTime(values[0]);\n        jQuery('#last_played_timestamp').attr('datetime', date.toISOString());\n        jQuery('#last_played_timestamp').timeago();\n      }\n    }).catch(function(err) { console.log(err); });\n  }\n\n  _drawModesPlayed() {\n    Promise.all([\n      this.reporting.filter('modes', { mode: 'survival' }).sum('played').value(),\n      this.reporting.filter('modes', { mode: 'classic' }).sum('played').value(),\n      this.reporting.filter('modes', { mode: 'battle' }).sum('played').value()\n    ]).then(function(values) {\n      var element = jQuery('#sum_played_chart');\n      var data = new google.visualization.arrayToDataTable([\n        ['Mode', 'Times Played'],\n        ['Survival', values[0] || 0],\n        ['Classic', values[1] || 0],\n        ['Battle', values[2] || 0]\n      ]);\n\n      // Set chart options\n      var options = {\n         title:'Modes Played',\n         width: element.width(),\n         height: 400,\n         pieHole: 0.4,\n         legend: { position: 'bottom' }\n      };\n\n      // Instantiate and draw our chart, passing in some options.\n      var chart = new google.visualization.PieChart(element[0]);\n      chart.draw(data, options);\n    }).catch(function(err) { console.log(err); });\n  }\n\n  _drawMaxScores() {\n    Promise.all([\n      this.reporting.filter('modes', { mode: 'survival' }).max('survival-score').value(),\n      this.reporting.filter('modes', { mode: 'classic' }).max('classic-score').value(),\n      this.reporting.filter('modes', { mode: 'battle' }).max('battle-score').value()\n    ]).then(function(values) {\n      var element = jQuery('#max_score_chart');\n      var data = new google.visualization.arrayToDataTable([\n        ['Mode', 'Max Score'],\n        ['Survival', values[0] || 0],\n        ['Classic', values[1] || 0],\n        ['Battle', values[2] || 0]\n      ]);\n\n      // Set chart options\n      var options = {\n        title:'Max Scores',\n        width: element.width(),\n        height: 400,\n        legend: { position: 'bottom' }\n      };\n\n      // Instantiate and draw our chart, passing in some options.\n      var chart = new google.visualization.ColumnChart(element[0]);\n      chart.draw(data, options);\n    }).catch(function(err) { console.log(err); });\n  }\n}\n\ngoogle.charts.load('current', {'packages':['corechart']});\ngoogle.charts.setOnLoadCallback(() => {\n  var report = new Reporting();\n  report.requireAuth().then(() => {\n    $(document).ready(() => {\n      report.draw();\n\n      $(window).resize(() => {\n        report.draw();\n      });\n    });\n  });\n});\n"]}