{"version":3,"sources":["app/pages/games/heartbeat.js"],"names":["Reporting","reporting","firebase","database","ref","_drawGamePlayed","_drawUsersPlayed","_drawLastPlayed","filter","sum","select","then","values","jQuery","text","catch","err","console","log","count","total","last","date","Date","setTime","attr","toISOString","timeago","google","charts","load","setOnLoadCallback","report","requireAuth","$","document","ready","draw","window","resize"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;;;;;;;;;IAEMA,S;;;AACJ,uBAAc;AAAA;;AAAA;;AAEZ,UAAKC,SAAL,GAAiB,wBAAkB,MAAKC,QAAL,CAAcC,QAAd,GAAyBC,GAAzB,CAA6B,sBAA7B,CAAlB,EAAwE,MAAKF,QAAL,CAAcC,QAAd,GAAyBC,GAAzB,CAA6B,2BAA7B,CAAxE,CAAjB;AAFY;AAGb;;;;2BAEM;AACL;AACA,WAAKC,eAAL;AACA,WAAKC,gBAAL;AACA,WAAKC,eAAL;AACD;;;sCAEiB;AAChB,WAAKN,SAAL,CAAeO,MAAf,GAAwBC,GAAxB,CAA4B,QAA5B,EAAsCC,MAAtC,CAA6C,CAA7C,EAAgDC,IAAhD,CAAqD,UAASC,MAAT,EAAiB;AACpEC,eAAO,oBAAP,EAA6BC,IAA7B,CAAkCF,OAAO,CAAP,KAAa,CAA/C;AACD,OAFD,EAEGG,KAFH,CAES,UAASC,GAAT,EAAc;AAAEC,gBAAQC,GAAR,CAAYF,GAAZ;AAAmB,OAF5C;AAGD;;;uCAEkB;AACjB,WAAKf,SAAL,CAAeO,MAAf,CAAsB,OAAtB,EAA+BC,GAA/B,CAAmC,QAAnC,EAA6CU,KAA7C,GAAqDR,IAArD,CAA0D,UAASS,KAAT,EAAgB;AACxEP,eAAO,oBAAP,EAA6BC,IAA7B,CAAkCM,KAAlC;AACD,OAFD,EAEGL,KAFH,CAES,UAASC,GAAT,EAAc;AAAEC,gBAAQC,GAAR,CAAYF,GAAZ;AAAmB,OAF5C;AAGD;;;sCAEiB;AAChB,WAAKf,SAAL,CAAeO,MAAf,GAAwBa,IAAxB,CAA6B,SAA7B,EAAwCX,MAAxC,CAA+C,CAA/C,EAAkDC,IAAlD,CAAuD,UAASC,MAAT,EAAiB;AACtE,YAAI,CAACA,OAAO,CAAP,CAAL,EAAgB;AACdC,iBAAO,wBAAP,EAAiCC,IAAjC,CAAsC,OAAtC;AACD,SAFD,MAEO;AACL,cAAIQ,OAAO,IAAIC,IAAJ,EAAX;AACAD,eAAKE,OAAL,CAAaZ,OAAO,CAAP,CAAb;AACAC,iBAAO,wBAAP,EAAiCY,IAAjC,CAAsC,UAAtC,EAAkDH,KAAKI,WAAL,EAAlD;AACAb,iBAAO,wBAAP,EAAiCc,OAAjC;AACD;AACF,OATD,EASGZ,KATH,CASS,UAASC,GAAT,EAAc;AAAEC,gBAAQC,GAAR,CAAYF,GAAZ;AAAmB,OAT5C;AAUD;;;;;;AAGHY,OAAOC,MAAP,CAAcC,IAAd,CAAmB,SAAnB,EAA8B,EAAC,YAAW,CAAC,WAAD,CAAZ,EAA9B;AACAF,OAAOC,MAAP,CAAcE,iBAAd,CAAgC,YAAM;AACpC,MAAIC,SAAS,IAAIhC,SAAJ,EAAb;AACAgC,SAAOC,WAAP,GAAqBtB,IAArB,CAA0B,YAAM;AAC9BuB,MAAEC,QAAF,EAAYC,KAAZ,CAAkB,YAAM;AACtBJ,aAAOK,IAAP;;AAEAH,QAAEI,MAAF,EAAUC,MAAV,CAAiB,YAAM;AACrBP,eAAOK,IAAP;AACD,OAFD;AAGD,KAND;AAOD,GARD;AASD,CAXD","file":"public/assets/js/pages/games/heartbeat.js","sourcesContent":["import GameReporting from '@greenhousegames/heartbeat/dist/reporting';\nimport FirebaseClient from 'firebase-client.js';\nimport rsvp from 'rsvp';\n\nclass Reporting extends FirebaseClient {\n  constructor() {\n    super();\n    this.reporting = new GameReporting(this.firebase.database().ref('games/heartbeat/data'), this.firebase.database().ref('games/heartbeat/reporting'));\n  }\n\n  draw() {\n    // metrics\n    this._drawGamePlayed();\n    this._drawUsersPlayed();\n    this._drawLastPlayed();\n  }\n\n  _drawGamePlayed() {\n    this.reporting.filter().sum('played').select(1).then(function(values) {\n      jQuery('#game_played_count').text(values[0] || 0);\n    }).catch(function(err) { console.log(err); });\n  }\n\n  _drawUsersPlayed() {\n    this.reporting.filter('users').sum('played').count().then(function(total) {\n      jQuery('#user_played_count').text(total);\n    }).catch(function(err) { console.log(err); });\n  }\n\n  _drawLastPlayed() {\n    this.reporting.filter().last('endedAt').select(1).then(function(values) {\n      if (!values[0]) {\n        jQuery('#last_played_timestamp').text('never');\n      } else {\n        var date = new Date();\n        date.setTime(values[0]);\n        jQuery('#last_played_timestamp').attr('datetime', date.toISOString());\n        jQuery('#last_played_timestamp').timeago();\n      }\n    }).catch(function(err) { console.log(err); });\n  }\n}\n\ngoogle.charts.load('current', {'packages':['corechart']});\ngoogle.charts.setOnLoadCallback(() => {\n  var report = new Reporting();\n  report.requireAuth().then(() => {\n    $(document).ready(() => {\n      report.draw();\n\n      $(window).resize(() => {\n        report.draw();\n      });\n    });\n  });\n});\n"]}