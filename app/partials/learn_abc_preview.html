<div class="abc column">
  <div id="card-letter-{{ letter }}" class="card">
    {{#if preview}}
    <div id="learning-game-{{ letter }}-container" class="show-for-medium">
      <div id="learning-game-{{ letter }}"></div>
      <img src="{{ @root.root }}assets/img/learning/preview-placeholder.png"></img>
    </div>
    {{/if}}
    {{#if showdivider}}
    <div class="card-divider primary show-for-medium">
      <h4>{{uppercase letter}}</h4>
    </div>
    {{/if}}
    <div class="card-section text-center">
      <p>{{ header }}</p>
      <a href="{{ @root.root }}learn/abc/{{ letter }}.html">START LESSON</a>
    </div>
  </div>
</div>
{{#if preview}}
<script>
$(document).ready(function() {
  var loaded = false, loading = false;
  $(window).on('changed.zf.mediaquery', function(event, newSize, oldSize) {
    changed(newSize);
  });
  changed(Foundation.MediaQuery.current);

  function changed(bp) {
    if (bp != 'small' && !loaded && !loading) {
      loading = true;
      $.getScript("{{ @root.root }}assets/js/pages/learn/abc/{{ letter }}.js")
        .done(function( script, textStatus ) {
          loaded = true;
          loading = false;
          load();
        })
        .fail(function( jqxhr, settings, exception ) {
          loading = false;
        });
    }
  }

  function load() {
    var create = require('pages/learn/abc/{{ letter }}.js');
    var game;
    $('#card-letter-{{ letter }}').hover(function() {
      if (!game) {
        $('#learning-game-{{ letter }}-container img').hide();
        $('#learning-game-{{ letter }}').show();
        game = create();
      }
    }, function() {
      $('#learning-game-{{ letter }}').fadeOut({
        complete: function() {
          if (game) {
            $('#learning-game-{{ letter }}-container img').show();
            game.destroy();
            game = null;
          }
        }
      });
    });
  }
});
</script>
{{/if}}
